# ============================================================================
# Webhook Platform - Environment Configuration Template
# ============================================================================
# Copy this file to .env and configure for your deployment mode
# 
# Deployment modes:
#   - embedded: PostgreSQL runs in Docker (self-hosted)
#   - external: Use external PostgreSQL (cloud/managed DB)

# ----------------------------------------------------------------------------
# DEPLOYMENT MODE (REQUIRED)
# ----------------------------------------------------------------------------
# Options: embedded | external
DB_MODE=embedded

# ----------------------------------------------------------------------------
# APPLICATION ENVIRONMENT
# ----------------------------------------------------------------------------
APP_ENV=development
# Options: development | staging | production
# Note: In production mode, placeholder secrets will cause startup failure

# ----------------------------------------------------------------------------
# DATABASE - EMBEDDED MODE (when DB_MODE=embedded)
# ----------------------------------------------------------------------------
# Used when running PostgreSQL in Docker
POSTGRES_IMAGE=postgres:16-alpine
POSTGRES_DB=webhook_platform
POSTGRES_USER=webhook_user
POSTGRES_PASSWORD=webhook_dev_pass_12345
POSTGRES_PORT=5432
POSTGRES_VOLUME_NAME=webhook_pgdata

# ----------------------------------------------------------------------------
# DATABASE - EXTERNAL MODE (when DB_MODE=external)
# ----------------------------------------------------------------------------
# Used when connecting to external/managed PostgreSQL
# For embedded mode, leave as 'postgres' (Docker service name)
# For external mode, change to your database host
DB_HOST=postgres
DB_PORT=5432
DB_NAME=webhook_platform
DB_USER=webhook_user
DB_PASSWORD=webhook_dev_pass_12345
DB_SSL_MODE=disable
# Options: require | verify-full | disable

# Optional: Override full JDBC URL (if set, DB_HOST/PORT/NAME are ignored)
DB_JDBC_URL=

# Connection pool settings (external mode)
DB_POOL_MAX_SIZE=10
DB_POOL_MIN_IDLE=5
DB_POOL_CONNECTION_TIMEOUT=30000

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION (for distributed rate limiting & concurrency)
# ----------------------------------------------------------------------------
REDIS_IMAGE=redis:7-alpine
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=webhook_redis_pass
REDIS_MAXMEMORY=256mb

# ----------------------------------------------------------------------------
# KAFKA CONFIGURATION
# ----------------------------------------------------------------------------
# For embedded mode, use kafka:9092 (Docker internal)
# For external mode, use your Kafka cluster URL
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_IMAGE=apache/kafka:3.7.0
# Number of partitions for highload (increase for more parallelism)
KAFKA_NUM_PARTITIONS=12

# ----------------------------------------------------------------------------
# SECURITY (REQUIRED - MUST CHANGE FOR PRODUCTION)
# ----------------------------------------------------------------------------
# Webhook secret encryption key (32+ characters, alphanumeric + special chars)
# CHANGE THIS IN PRODUCTION!
WEBHOOK_ENCRYPTION_KEY=dev_encryption_key_32_chars_min

# PBKDF2 salt for AES-256 key derivation (16+ characters, unique per deployment)
# CHANGE THIS IN PRODUCTION!
WEBHOOK_ENCRYPTION_SALT=dev_encryption_salt_16_chars

# JWT secret for API authentication (32+ characters)
# CHANGE THIS IN PRODUCTION!
JWT_SECRET=dev_jwt_secret_key_32_chars_minimum

# ----------------------------------------------------------------------------
# API SERVICE
# ----------------------------------------------------------------------------
API_PORT=8080
API_IMAGE_TAG=latest

# ----------------------------------------------------------------------------
# WORKER SERVICE
# ----------------------------------------------------------------------------
WORKER_PORT=8081
WORKER_IMAGE_TAG=latest

# ----------------------------------------------------------------------------
# UI SERVICE
# ----------------------------------------------------------------------------
UI_PORT=5173
UI_IMAGE_TAG=latest
VITE_API_URL=http://localhost:8080

# ----------------------------------------------------------------------------
# DATA RETENTION POLICIES
# ----------------------------------------------------------------------------
# Days to keep published outbox messages (cleanup runs daily at 2 AM)
DATA_RETENTION_OUTBOX_DAYS=7

# Days to keep delivery attempts (cleanup runs daily at 2 AM)
DATA_RETENTION_ATTEMPTS_DAYS=90

# Maximum attempts to retain per delivery (keeps most recent N)
DATA_RETENTION_MAX_ATTEMPTS_PER_DELIVERY=10

# Batch size for cleanup operations
DATA_RETENTION_BATCH_SIZE=1000

# Cron schedule for cleanup (daily at 2 AM)
DATA_RETENTION_CRON=0 0 2 * * *

# Cron schedule for limit enforcement (every 30 minutes)
DATA_RETENTION_LIMIT_CRON=0 */30 * * * *

# ----------------------------------------------------------------------------
# RATE LIMITING
# ----------------------------------------------------------------------------
# Events per second per project (token bucket)
EVENT_INGESTION_RATE_LIMIT_PER_SECOND=100

# Auth rate limiting (per IP and per email, per minute)
AUTH_RATE_LIMIT_LOGIN_PER_MINUTE=10
AUTH_RATE_LIMIT_REGISTER_PER_MINUTE=5

# ----------------------------------------------------------------------------
# WEBHOOK DELIVERY
# ----------------------------------------------------------------------------
# Maximum event payload size in bytes (default 256KB)
WEBHOOK_MAX_PAYLOAD_SIZE_BYTES=262144

# Allow webhooks to private IPs (disable in production)
WEBHOOK_ALLOW_PRIVATE_IPS=true

# Comma-separated list of allowed hosts (empty = all allowed)
WEBHOOK_ALLOWED_HOSTS=

# ----------------------------------------------------------------------------
# ORDERING (FIFO delivery per endpoint)
# ----------------------------------------------------------------------------
# Gap timeout in seconds (proceed without previous sequence after this time)
ORDERING_GAP_TIMEOUT_SECONDS=60

# TTL for delivered sequence tracking in Redis (hours)
ORDERING_DELIVERED_SEQ_TTL_HOURS=24

# TTL for ordering buffer in Redis (minutes)
ORDERING_BUFFER_TTL_MINUTES=10

# ----------------------------------------------------------------------------
# RETRY SCHEDULER
# ----------------------------------------------------------------------------
# Batch size for processing pending retries
RETRY_SCHEDULER_BATCH_SIZE=100

# Timeout in seconds for Kafka send confirmation
RETRY_SCHEDULER_SEND_TIMEOUT_SECONDS=30

# Delay in seconds before rescheduling failed sends
RETRY_SCHEDULER_RESCHEDULE_DELAY_SECONDS=60

# Poll interval in milliseconds
RETRY_SCHEDULER_POLL_INTERVAL_MS=10000

# ----------------------------------------------------------------------------
# STUCK DELIVERY RECOVERY
# ----------------------------------------------------------------------------
# Threshold in minutes - deliveries stuck in PROCESSING longer than this will be reset
STUCK_DELIVERY_THRESHOLD_MINUTES=5

# Check interval in milliseconds
STUCK_DELIVERY_CHECK_INTERVAL_MS=60000

# ----------------------------------------------------------------------------
# TEST ENDPOINTS (Request Bin)
# ----------------------------------------------------------------------------
# Base URL for generated test endpoint URLs
TEST_ENDPOINT_BASE_URL=http://webhook-api:8080

# Maximum test endpoints per project
TEST_ENDPOINT_MAX_PER_PROJECT=10

# Maximum TTL in hours for test endpoints
TEST_ENDPOINT_MAX_TTL_HOURS=72

# Cleanup interval for expired endpoints (ms)
TEST_ENDPOINT_CLEANUP_INTERVAL_MS=3600000

# ----------------------------------------------------------------------------
# EMAIL VERIFICATION
# ----------------------------------------------------------------------------
# Enable sending real emails (false = log verification URL to console)
EMAIL_ENABLED=false

# From address for verification emails
EMAIL_FROM=noreply@hookflow.dev

# Base URL for verification links (must match your UI URL)
EMAIL_BASE_URL=http://localhost:5173

# SMTP settings (only used when EMAIL_ENABLED=true)
SMTP_HOST=localhost
SMTP_PORT=1025
SMTP_USERNAME=
SMTP_PASSWORD=
SMTP_AUTH=false
SMTP_STARTTLS=false

# ----------------------------------------------------------------------------
# CORS CONFIGURATION
# ----------------------------------------------------------------------------
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# ----------------------------------------------------------------------------
# MINIO (OPTIONAL - for future file storage)
# ----------------------------------------------------------------------------
MINIO_IMAGE=minio/minio:RELEASE.2024-01-16T16-07-38Z
MINIO_ROOT_USER=minio_admin
MINIO_ROOT_PASSWORD=minio_dev_password_12345
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001

# ----------------------------------------------------------------------------
# OBSERVABILITY
# ----------------------------------------------------------------------------
# Log level: TRACE | DEBUG | INFO | WARN | ERROR
LOG_LEVEL=INFO

# Enable/disable Swagger UI (set to false in production)
SWAGGER_ENABLED=true

# ----------------------------------------------------------------------------
# JVM TUNING
# ----------------------------------------------------------------------------
# Custom JVM options (override defaults in Dockerfile)
# Default: G1GC, UseContainerSupport, MaxRAMPercentage=75%
# API_JAVA_OPTS=-Xms256m -Xmx384m
# WORKER_JAVA_OPTS=-Xms384m -Xmx512m

# Enable Prometheus metrics export
METRICS_ENABLED=true

# ----------------------------------------------------------------------------
# BACKUP CONFIGURATION (embedded mode only)
# ----------------------------------------------------------------------------
BACKUP_DIR=./backups
BACKUP_RETENTION_DAYS=30
