# ============================================================================
# Webhook Platform - Environment Configuration Template
# ============================================================================
# Copy this file to .env and configure for your deployment mode
# 
# Deployment modes:
#   - embedded: PostgreSQL runs in Docker (self-hosted)
#   - external: Use external PostgreSQL (cloud/managed DB)

# ----------------------------------------------------------------------------
# DEPLOYMENT MODE (REQUIRED)
# ----------------------------------------------------------------------------
# Options: embedded | external
DB_MODE=embedded

# ----------------------------------------------------------------------------
# APPLICATION ENVIRONMENT
# ----------------------------------------------------------------------------
APP_ENV=development
# Options: development | staging | production
# Note: In production mode, placeholder secrets will cause startup failure

# ----------------------------------------------------------------------------
# DATABASE - EMBEDDED MODE (when DB_MODE=embedded)
# ----------------------------------------------------------------------------
# Used when running PostgreSQL in Docker
POSTGRES_IMAGE=postgres:16-alpine
POSTGRES_DB=webhook_platform
POSTGRES_USER=webhook_user
POSTGRES_PASSWORD=webhook_dev_pass_12345
POSTGRES_PORT=5432
POSTGRES_VOLUME_NAME=webhook_pgdata

# ----------------------------------------------------------------------------
# DATABASE - EXTERNAL MODE (when DB_MODE=external)
# ----------------------------------------------------------------------------
# Used when connecting to external/managed PostgreSQL
# For embedded mode, leave as 'postgres' (Docker service name)
# For external mode, change to your database host
DB_HOST=postgres
DB_PORT=5432
DB_NAME=webhook_platform
DB_USER=webhook_user
DB_PASSWORD=webhook_dev_pass_12345
DB_SSL_MODE=disable
# Options: require | verify-full | disable

# Optional: Override full JDBC URL (if set, DB_HOST/PORT/NAME are ignored)
DB_JDBC_URL=

# Connection pool settings (external mode)
DB_POOL_MAX_SIZE=10
DB_POOL_MIN_IDLE=5
DB_POOL_CONNECTION_TIMEOUT=30000

# ----------------------------------------------------------------------------
# REDIS CONFIGURATION (for distributed rate limiting & concurrency)
# ----------------------------------------------------------------------------
REDIS_IMAGE=redis:7-alpine
REDIS_HOST=redis
REDIS_PORT=6379
REDIS_MAXMEMORY=256mb

# ----------------------------------------------------------------------------
# KAFKA CONFIGURATION
# ----------------------------------------------------------------------------
# For embedded mode, use kafka:9092 (Docker internal)
# For external mode, use your Kafka cluster URL
KAFKA_BOOTSTRAP_SERVERS=kafka:9092
KAFKA_IMAGE=apache/kafka:3.7.0
# Number of partitions for highload (increase for more parallelism)
KAFKA_NUM_PARTITIONS=12

# ----------------------------------------------------------------------------
# SECURITY (REQUIRED - MUST CHANGE FOR PRODUCTION)
# ----------------------------------------------------------------------------
# Webhook secret encryption key (32+ characters, alphanumeric + special chars)
# CHANGE THIS IN PRODUCTION!
WEBHOOK_ENCRYPTION_KEY=dev_encryption_key_32_chars_min

# JWT secret for API authentication (32+ characters)
# CHANGE THIS IN PRODUCTION!
JWT_SECRET=dev_jwt_secret_key_32_chars_minimum

# ----------------------------------------------------------------------------
# API SERVICE
# ----------------------------------------------------------------------------
API_PORT=8080
API_IMAGE_TAG=latest

# ----------------------------------------------------------------------------
# WORKER SERVICE
# ----------------------------------------------------------------------------
WORKER_PORT=8081
WORKER_IMAGE_TAG=latest

# ----------------------------------------------------------------------------
# UI SERVICE
# ----------------------------------------------------------------------------
UI_PORT=5173
UI_IMAGE_TAG=latest
VITE_API_URL=http://localhost:8080

# ----------------------------------------------------------------------------
# DATA RETENTION POLICIES
# ----------------------------------------------------------------------------
# Days to keep published outbox messages (cleanup runs daily at 2 AM)
DATA_RETENTION_OUTBOX_DAYS=7

# Days to keep delivery attempts (cleanup runs daily at 2 AM)
DATA_RETENTION_ATTEMPTS_DAYS=90

# Maximum attempts to retain per delivery (keeps most recent N)
DATA_RETENTION_MAX_ATTEMPTS_PER_DELIVERY=10

# Batch size for cleanup operations
DATA_RETENTION_BATCH_SIZE=1000

# Cron schedule for cleanup (daily at 2 AM)
DATA_RETENTION_CRON=0 0 2 * * *

# Cron schedule for limit enforcement (every 30 minutes)
DATA_RETENTION_LIMIT_CRON=0 */30 * * * *

# ----------------------------------------------------------------------------
# RATE LIMITING
# ----------------------------------------------------------------------------
# Events per second per project (token bucket)
EVENT_INGESTION_RATE_LIMIT_PER_SECOND=100

# ----------------------------------------------------------------------------
# WEBHOOK DELIVERY
# ----------------------------------------------------------------------------
# Allow webhooks to private IPs (disable in production)
WEBHOOK_ALLOW_PRIVATE_IPS=false

# Comma-separated list of allowed hosts (empty = all allowed)
WEBHOOK_ALLOWED_HOSTS=

# ----------------------------------------------------------------------------
# CORS CONFIGURATION
# ----------------------------------------------------------------------------
CORS_ALLOWED_ORIGINS=http://localhost:5173,http://localhost:3000

# ----------------------------------------------------------------------------
# MINIO (OPTIONAL - for future file storage)
# ----------------------------------------------------------------------------
MINIO_IMAGE=minio/minio:RELEASE.2024-01-16T16-07-38Z
MINIO_ROOT_USER=minio_admin
MINIO_ROOT_PASSWORD=minio_dev_password_12345
MINIO_PORT=9000
MINIO_CONSOLE_PORT=9001

# ----------------------------------------------------------------------------
# OBSERVABILITY
# ----------------------------------------------------------------------------
# Log level: TRACE | DEBUG | INFO | WARN | ERROR
LOG_LEVEL=INFO

# Enable/disable Swagger UI (set to false in production)
SWAGGER_ENABLED=true

# ----------------------------------------------------------------------------
# JVM TUNING
# ----------------------------------------------------------------------------
# Custom JVM options (override defaults in Dockerfile)
# Default: G1GC, UseContainerSupport, MaxRAMPercentage=75%
# API_JAVA_OPTS=-Xms256m -Xmx384m
# WORKER_JAVA_OPTS=-Xms384m -Xmx512m

# Enable Prometheus metrics export
METRICS_ENABLED=true

# ----------------------------------------------------------------------------
# BACKUP CONFIGURATION (embedded mode only)
# ----------------------------------------------------------------------------
BACKUP_DIR=./backups
BACKUP_RETENTION_DAYS=30
